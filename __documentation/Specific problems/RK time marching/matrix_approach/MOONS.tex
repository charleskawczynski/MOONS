\documentclass[11pt]{article}
\input{../includes.tex}

\newcommand{\ReInv}{Re^{-1}}
\newcommand{\RemInv}{Re_m^{-1}}
\newcommand{\Al}{N Re_m^{-1}}
\newcommand{\Interaction}{N}

\begin{document}

\MOONSTITLE
% \maketitle
\vspace{-10em}

\section{Desired equations to solve}
\begin{equation}
  \PD_t \U - \ReInv \DEL^2 \U
  = - \DEL p + \left( \DEL \DOT (\U \U^T) \\ + \Al
  (\CURL \B) \CROSS \B \right)
\end{equation}
\begin{equation}
  \DEL \DOT \U = 0
\end{equation}
\begin{equation}
  \PD_t \B + \RemInv \DEL \CROSS ( \SO^{-1} \DEL \CROSS \B ) = -\DEL \phi + \left( \DEL \CROSS \U \CROSS \B \right)
\end{equation}
\begin{equation}
  \DEL \DOT \B = 0
\end{equation}

\section{Vector form}
Let
\begin{equation}
\X = \MAT{c} \U \\ \B \\ \EMAT, \qquad
\zeta = \MAT{c} p \\ \phi \\ \EMAT
\end{equation}
and
\begin{equation}
\MAC L =
\MAT{c c}
-\ReInv \DEL^2 & 0 \\
0 & \RemInv \DEL \CROSS ( \SO^{-1} \DEL \CROSS ) \\
\EMAT
\end{equation}
\begin{equation}
\MAC F =
\MAT{c}
\DEL \DOT (\U \U^T) + \Al (\CURL \B) \CROSS \B \\
\DEL \CROSS \U \CROSS \B \\
\EMAT
\end{equation}
Our equations then become:
\begin{equation}
  \PD_t \X + \underbrace{\MAC L}_{\text{linear operator}} \X = \underbrace{- \DEL \zeta}_{\text{enforces constraint}} + \underbrace{\MAC F}_{\text{explicitly treated}}
\end{equation}
\begin{equation}
  \DEL \DOT \X = 0
\end{equation}

\section{Paper by Nikitin Verbatim Equations}
Ref: Nikitin, Nikolay. "Third-order-accurate semi-implicit Runge-Kutta scheme for incompressible Navier-Stokes equations." International Journal for Numerical Methods in Fluids 51.2 (2006): 221-233.

This paper uses the following 3rd order accurate RK scheme:

\begin{equation}\begin{aligned}
  \frac{dw}{dt} = F(t,w) \\
  \frac{w'-w_n}{\tau} = \frac{2}{3} F_n + \gamma L(w' - w_n) \\
  \frac{w''-w_n}{\tau} = \frac{1}{3} F_n + \frac{1}{3} F' + \gamma L(w'' - w') \\
  \frac{w_{n+1}        -w_n}{\tau} = \frac{1}{4} F_n + \frac{3}{4} F'' + \gamma L(w_{n+1} - \tilde{w}_{n+1}) \\
  . \\
  \frac{\tilde{w}_{n+1}-w_n}{\tau} = \frac{1}{4} F_n + \frac{3}{4} F'  + \gamma L(\tilde{w}_{n+1} - \bar{w}_{n+1}) \\
  \bar{w}_{n+1} = \frac{3}{2} (\alpha w' + (1-\alpha) w'') - \frac{1}{2} w_n \\
  \gamma = \frac{1}{3} \\
  \alpha = \frac{3}{2} \\
  F' = F(t_n + \frac{2\tau}{3},w') \\
  F'' = F(t_n + \frac{2\tau}{3},w'') \\
\end{aligned}\end{equation}
Final compact form

\begin{equation}\begin{aligned}
  H_n = H(t_n,w_n) \\
  D G p_n = D H_n \\
  (I - \gamma \tau L) (w' - w_n) = \frac{2}{3} \tau (H_n - G p_n) \\
\end{aligned}\end{equation}
\begin{equation}\begin{aligned}
  H' = H(t_n + 2 \tau/3,w') \\
  D G p' = D H' \\
  (I - \gamma \tau L) (w'' - \frac{3}{2}w' + \frac{1}{2} w_n) = \frac{1}{3} \tau (H' - G p') + w_n - w' \\
  (I - \gamma \tau L) (\tilde{w}_{n+1} - \frac{3}{2}w'' + \frac{3}{4} w' - \frac{1}{4}w_n) = \frac{3}{4} (w'' - w_n) \\
\end{aligned}\end{equation}
\begin{equation}\begin{aligned}
  H'' = H(t_n + 2 \tau/3,w'') \\
  (I - \gamma \tau L) (\hat{w}_{n+1} - \frac{1}{2} \tilde{w}_{n+1} - \frac{3}{4} w'' + \frac{1}{4} w_n) = \frac{3}{4} \tau (H'' - G p') + \frac{5}{8} w_n + \frac{3}{8} w'' - \tilde{w}_{n+1} \\
  D G q = D \hat{w}_{n+1} \\
  w_{n+1} = \hat{w}_{n+1} - Gq \\
\end{aligned}\end{equation}

The last step does not includevector $w'$, thus, storage for only four velocity vectors plus one pressure vector is necessaryto perform all the steps of the scheme.

After calculation of $w_{n+1}$ vectors $\tilde{w}_{n+1}$ and $w_n$ are kept safe, so that the local error may be estimated by
\begin{equation}\begin{aligned}
 err = || w_{n+1} - \tilde{w}_{n+1} ||, \\
\end{aligned}\end{equation}
and the integration may be repeated starting from $t_n$ if necessary. In the conclusion it is noted that the presented scheme is completely self-starting. Only an initial condition for the velocity $w_n$ is needed to perform all the steps.

\newpage
\section{Converting to form with MHD variables}
The governing equations are defined as
\begin{equation}\begin{aligned}
  \PD_t w = H(t,w) - G p \\
\end{aligned}\end{equation}
Here, $H$ contains the convective AND viscous terms. Let the discrete operators be denoted by $D = \DIV, L = \DEL^2$. A simple direct conversion to our standard naming convention yields
\begin{equation}\begin{aligned}
  % F = H(t,w) - G p = - \MAC L \X + \MAC F - G \zeta \\
  F = H(w(t)) - G p = - \MAC L \X + \MAC F - G \zeta \\
\end{aligned}\end{equation}
Simply choosing the linear operator $\MAC L$ for the linear operator $L$ (introduced in equation 5 of Nikitin) yields. NOTE: here, we still use $L$ to denote the Laplacian operator, not the linear operator used in Nikitin.
\begin{equation}\begin{aligned}
  F_n = F(\X_n) \\
  L \zeta_n = D F_n \\
  (I - \gamma \tau \MAC L) (\X' - \X_n) = \frac{2}{3} \tau (F_n - G \zeta_n) \\
\end{aligned}\end{equation}
\begin{equation}\begin{aligned}
  % F' = F(t_n + 2 \tau/3,\X') \\
  F' = F(\X') \\
  L \zeta' = D F' \\
  (I - \gamma \tau \MAC L) \left(\X'' - \frac{3}{2}\X' + \frac{1}{2} \X_n \right) = \frac{1}{3} \tau (F' - G \zeta') + \X_n - \X' \\
  (I - \gamma \tau \MAC L) \left(\tilde{\X}_{n+1} - \frac{3}{2}\X'' + \frac{3}{4} \X' - \frac{1}{4}\X_n\right) = \frac{3}{4} (\X'' - \X_n) \\
\end{aligned}\end{equation}
\begin{equation}\begin{aligned}
  % F'' = F(t_n + 2 \tau/3,\X'') \\
  F'' = F(\X'') \\
  (I - \gamma \tau \MAC L) \left(\hat{\X}_{n+1} - \frac{1}{2} \tilde{\X}_{n+1} - \frac{3}{4} \X'' + \frac{1}{4} \X_n\right) = \frac{3}{4} \tau (F'' - G \zeta') + \frac{5}{8} \X_n + \frac{3}{8} \X'' - \tilde{\X}_{n+1} \\
  L q = D \hat{\X}_{n+1} \\
  \X_{n+1} = \hat{\X}_{n+1} - G q \\
\end{aligned}\end{equation}

\section{Confirming decoupled system}
To finalize that this time marching method will work with the coupled system, we must know that solving each linear system can be performed separately. All of the linear systems are can be written in a simplified form of:
\begin{equation}\begin{aligned}
  (I - \gamma \tau \MAC L) \X_{temp} = \Y \\
\end{aligned}\end{equation}
Where $\Y$ is known. Substituting the linear operator in, we have
\begin{equation}\begin{aligned}
  \left(I - \gamma \tau \MAT{c c}
-\ReInv \DEL^2 & 0 \\
0 & \RemInv \DEL \CROSS ( \SO^{-1} \DEL \CROSS ) \\
\EMAT
 \right) \X_{temp} = \Y \\
  \left(\MAT{c c}
1 + \gamma \tau\ReInv \DEL^2 & 0 \\
0 & 1-\gamma \tau \RemInv \DEL \CROSS ( \SO^{-1} \DEL \CROSS ) \\
\EMAT
 \right) \X_{temp} = \Y \\
\end{aligned}\end{equation}
This confirms that the systems are in fact decoupled, since each equation can be solved separately since $\Y$ is constant for each iteration.

\newpage
\section{Paper}

\begin{equation}
  \PD_t \X = f(\X),
\end{equation}
\begin{equation}
  % \DEL \DOT \X = 0
  g(\X) = 0
\end{equation}


\section{RK4 method wikipedia}
The governing equations are
\begin{equation}\begin{aligned}
  \PD_t u = f(t,u) \\
\end{aligned}\end{equation}
The formal RK4 method can be outlined as
\begin{equation}\begin{aligned}
  u_{n+1} = u_n + \frac{\Delta t}{6} (k_1 + 2 k_2 + 2k_3 + k_4) \\
  t_{n+1} = t_n + \Delta t \\
  k_1 = f(t_n,u_n) \\
  k_2 = f\left(t_n + \frac{\Delta t}{2} , u_n + \frac{\Delta t}{2} k_1 \right) \\
  k_3 = f\left(t_n + \frac{\Delta t}{2} , u_n + \frac{\Delta t}{2} k_3 \right) \\
  k_4 = f\left(t_n + \Delta t , u_n + \Delta t k_3 \right) \\
\end{aligned}\end{equation}
\section{Low storage RK3 method Nikitin}
The method is outlined as follows
\begin{equation}\begin{aligned}
  \PD_t \U = F(t,\U) \\
  \frac{\U'     -\U_n}{\tau} = \alpha_1 \F_n + \beta_1 \F' + \gamma_1 \F'', \quad \F_n = \F(t_n,\U_n)           , \quad \alpha_1 = \frac{2}{3}, \quad \beta_1 =     0      , \quad \gamma_1 = 0           \\
  \frac{\U''    -\U_n}{\tau} = \alpha_2 \F_n + \beta_2 \F' + \gamma_2 \F'', \quad \F'  = \F(t_n+2\tau/3,\U')    , \quad \alpha_2 = \frac{1}{3}, \quad \beta_2 = \frac{1}{3}, \quad \gamma_2 = 0           \\
  \frac{\U_{n+1}-\U_n}{\tau} = \alpha_3 \F_n + \beta_3 \F' + \gamma_3 \F'', \quad \F'' = \F(t_n+2\tau/3,\U_n'') , \quad \alpha_3 = \frac{1}{4}, \quad \beta_3 =     0      , \quad \gamma_3 = \frac{3}{4} \\
  t_{n+1} = t_n + \tau \\
\end{aligned}\end{equation}
In matrix form, we may write this as
\begin{equation}
\MAT{c c c c}
A & G \\
D & 0 \\
\EMAT
\MAT{c} \U' \\ \U'' \\ \U^{n+1} \EMAT =
\MAT{c c c c}
\alpha_1 & \beta_1 & \gamma_1 \\
\alpha_2 & \beta_2 & \gamma_2 \\
\alpha_3 & \beta_3 & \gamma_3 \\
\EMAT
\MAT{c} \F_n \\ \F' \\ \F'' \EMAT
\end{equation}



\section{Desired equations to solve}
The semi-discretized equations are
\begin{multline}
\frac{\U^{n+1}-\U^n}{\Delta t} - \theta_u \ReInv L\U^{n+1} = - G p^{n+1} + (1-\theta_u) \ReInv L\U^n + \R, \\
\R = - D(\U \U^T) + \Al (C\B) \CROSS \B, \\
 D \U^{n+1} = 0, \\
\end{multline}
\begin{multline}
\frac{\B^{n+1}-\B^n}{\Delta t} + \theta_B \RemInv C (\left[ \SO^{-1} C\B^{n+1}) \right] = - G\correctB^{n+1} - (1-\theta_B) \RemInv C (\left[ \SO^{-1} C\B^n) \right] + \T, \\
\T = C (\U \CROSS \B), \\
 D \B^{n+1} = 0. \\
\end{multline}


\section{My matrix approach}
From the Perot analysis, the equations we wish to solve are
\begin{equation}
\MAT{c c c c}
A_u & G & 0   & 0 \\
D   & 0 & 0   & 0 \\
0   & 0 & A_B & G \\
0   & 0 & D   & 0 \\
\EMAT
\MAT{c} \U^{n+1} \\ p^{n+1} \\ \B^{n+1} \\ \correctB^{n+1} \\ \EMAT =
\MAT{c} \MAC R \\ 0  \\ \MAC T \\ 0  \\ \EMAT +
\MAT{c} BC_1 \\ BC_2 \\BC_3 \\ BC_4 \\ \EMAT,
\end{equation}
\begin{equation}\LL\begin{aligned}
& A_u  = \frac{1}{\Delta t} \left(I - \Delta t \theta_u \ReInv L \right), \\
& A_B  = \frac{1}{\Delta t} \left(I + \Delta t \theta_B \RemInv C (\SO^{-1} C) \right), \\
& \MAC R = \frac{1}{\Delta t} \left(I + \Delta t (1-\theta_u) \ReInv L \right) \U^n + \frac{3}{2}\R^n - \frac{1}{2}\R^{n-1}. \\
& \MAC T = \frac{1}{\Delta t} [I - \Delta t(1-\theta_B) \RemInv C ( \SO^{-1} C) ]\B^n + \frac{3}{2} \T^n - \frac{1}{2} \T^{n-1}. \\
\end{aligned} \end{equation}


\end{document}