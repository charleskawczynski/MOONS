\documentclass[11pt]{article}
\usepackage{graphicx}    % needed for including graphics e.g. EPS, PS
\usepackage{epstopdf}
\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{xspace}
\usepackage{mathtools}
\usepackage{tikz}
\usepackage{epsfig}
\usepackage{float}
%\usepackage{natbib}
\usepackage{subfigure}
\usepackage{setspace}
\usepackage{tabularx,ragged2e,booktabs,caption}


\setlength{\oddsidemargin}{0.1in}
\setlength{\textwidth}{7.25in}

\setlength{\topmargin}{-1in}     %\topmargin: gap above header
\setlength{\headheight}{0in}     %\headheight: height of header
\setlength{\topskip}{0in}        %\topskip: between header and text
\setlength{\headsep}{0in}        
\setlength{\textheight}{692pt}   %\textheight: height of main text
\setlength{\textwidth}{7.5in}    % \textwidth: width of text
\setlength{\oddsidemargin}{-0.5in}  % \oddsidemargin: odd page left margin
\setlength{\evensidemargin}{0in} %\evensidemargin : even page left margin
\setlength{\parindent}{0.25in}   %\parindent: indentation of paragraphs
\setlength{\parskip}{0pt}        %\parskip: gap between paragraphs
\setlength{\voffset}{0.5in}


% Useful commands:

% \hfill		aligns-right everything right of \hfill

\begin{document}
\doublespacing
\title{Magnetohydrodynamic Object-Oriented Numerical Simulation (MOONS)}
\author{C. Kawczynski \\
Department of Mechanical and Aerospace Engineering \\
University of California Los Angeles, USA\\
}
\maketitle

\section{Derivation of the Dimensionless momentum equation (Navier Stokes)}
\subsection{Dimensionless NS with j Cross B Force}
\begin{equation}
	\rho \left( \frac{\partial \pmb{u}}{\partial t} + \pmb{u} \bullet \nabla \pmb{u} \right) = 
	-\nabla p + \mu \nabla^2 \pmb{u} + \pmb{f} + \pmb{j} \times \pmb{B}
\end{equation}
Where $\pmb{f}$ is some dimensional force per unit volume. Non-dimensionalizing by

\begin{equation}
	\pmb{u}^* = \pmb{u}/U_c \qquad
	t^* = t/t_c \qquad
	t_c = L_c/U_c \qquad
	\nabla^* = L_c \nabla \qquad
	\rho = \rho_c
\end{equation}
\begin{equation}
	p^* = p/\rho_c U_c^2 \qquad
	\pmb{j}^* = \pmb{j}/ \sigma_c U_c B_c \qquad
	\pmb{B}^* = \pmb{B}/B_c
\end{equation}
Yields
\begin{equation}
	\rho_c \left( \frac{U_c^2}{L_c} \frac{\partial \pmb{u^*}}{\partial t} + \frac{U_c^2}{L_c} \pmb{u^*} \bullet \nabla^* \pmb{u^*} \right) = 
	- \rho_c \frac{U_c^2}{L_c} \nabla^*  p^* + \mu \frac{U_c}{L_c^2} {\nabla^*}^2 \pmb{u^*} + \pmb{f} +
	U_c B_c^2 \sigma_c \pmb{j^*} \times \pmb{B^*}
\end{equation}
Dividing by $\frac{\rho_c U_c^2}{L_c}$ yields
\begin{equation}
	\frac{\partial \pmb{u^*}}{\partial t} + \pmb{u^*} \bullet \nabla^* \pmb{u^*} = 
	- \nabla^*  p^* + 
	\frac{\nu_c}{U_c L_c} {\nabla^*}^2 \pmb{u^*} + \frac{L_c}{\rho_c U_c^2} \pmb{f} + 
	\frac{L_c B_c^2 \sigma_c}{\rho_c U_c} \pmb{j^*} \times \pmb{B^*}
\end{equation}
Note that
\begin{equation}
	\pmb{j}^*
	=
	\frac{\pmb{j}}{\sigma_c U_c B_c}
	=
	\frac{\nabla \times \left( \frac{\pmb{B}}{\mu} \right)}{\sigma_c U_c B_c}
	=
	\frac{ \frac{B_c}{\mu_c L_c} \nabla^* \times \left( \frac{\pmb{B}^*}{\mu^*} \right)}{\sigma_c U_c B_c}
	=
	\frac{1}{Re_m} \nabla \times \left( \frac{\pmb{B}^*}{\mu^*} \right)
\end{equation}
\begin{equation}
	\boxed{
	\pmb{j}^*
	=
	\frac{1}{Re_m} \nabla \times \left( \frac{\pmb{B}^*}{\mu^*} \right)
	}
\end{equation}

Re-ordering, and removing the asterisk, we have
\begin{equation}
	\frac{\partial \pmb{u}}{\partial t} + \frac{U_c^2}{L_c} \pmb{u} \bullet \nabla \pmb{u} = 
	- \nabla  p + 
	\frac{\nu_c}{U_c L_c} {\nabla}^2 \pmb{u} + \frac{L_c}{\rho_c U_c^2} \pmb{f} + 
	\frac{\mu_c}{\rho_c U_c L_c} 
	L_c^2 B_c^2 \frac{\sigma_c}{\rho_c \mu_c}
	\pmb{j} \times \pmb{B}
\end{equation}
Finally, we have
\begin{equation}
	\boxed{
	\frac{\partial \pmb{u}}{\partial t} + \pmb{u} \bullet \nabla \pmb{u} = 
	-\nabla  p + 
	\frac{1}{Re} {\nabla}^2 \pmb{u} + \frac{L_c}{\rho_c U_c^2} \pmb{f} + 
	\frac{Ha^2}{Re} \pmb{j} \times \pmb{B}
	}
\end{equation}
OR
\begin{equation}
	\boxed{
	\frac{\partial \pmb{u}}{\partial t} + \pmb{u} \bullet \nabla \pmb{u} = 
	-\nabla  p + 
	\frac{1}{Re} {\nabla}^2 \pmb{u} + \frac{L_c}{\rho_c U_c^2} \pmb{f} + 
	\frac{Ha^2}{Re Re_m} (\nabla \times \pmb{B}) \times \pmb{B}
	}
\end{equation}
Where
\begin{equation}
	Re = \frac{U_c L_c}{\nu_c} \qquad
	Ha = B_c L_c \sqrt{\frac{\sigma_c}{\mu_c}} \qquad
	Re_m = \mu_c \sigma_c U_c L_c
\end{equation}
	Using the kronecker delta relation, we may write this as
\begin{equation}
	\frac{\partial u_i }{\partial t} + u_j \partial_j u_i = 
	-\partial_i  p + 
	\frac{1}{Re} \partial_j \partial_j u_i + 
	\frac{L_c}{\rho_c U_c^2} f_i +
	\frac{Ha^2}{Re} \pmb{j} \times \pmb{B}
\end{equation}
We may write the $\pmb{j}\times \pmb{B}$ force as

\begin{equation}
	\pmb{j}\times \pmb{B} = \epsilon_ijk j_j B_k = 
	\epsilon_ijk \left( \epsilon_jmn \partial_m \frac{B_n}{\mu} B_k \right)
\end{equation}
\begin{equation}
	= \epsilon_ijk \epsilon_jmn \left( \partial_m \frac{B_n}{\mu} B_k \right)
	= \epsilon_jki \epsilon_jmn \left( \partial_m \frac{B_n}{\mu} B_k \right)
\end{equation}
\begin{equation}
	= (\delta_{km} \delta_{in} - \delta_{kn} \delta_{im} ) \left( \partial_m \frac{B_n}{\mu} B_k \right)
\end{equation}
\begin{equation}
	= \left( \partial_k \frac{B_i}{\mu} B_k \right) - 
	\left( \partial_i \frac{B_k}{\mu} B_k \right)
\end{equation}

\begin{equation}
	\pmb{j} \times \pmb{B} = B_k 
	\left( \partial_k \frac{B_i}{\mu} - \partial_i \frac{B_k}{\mu} \right)
\end{equation}

\subsection{Dimensionless NS with gravity, buyancy and j Cross B Force using index notation}
\begin{equation}
	\rho 
	\left( 
	\frac{\partial u_i}{\partial t} + 
	\frac{\partial (u_i u_j)}{\partial x_j}
	\right) 
	= 
	- \frac{\partial p}{\partial x_j}
	+ \mu \frac{\partial^2 u_i}{\partial x_j^2}
	+ \rho g_i
	+ \rho g_i \beta \Delta T
	+ (j \times B)_i
\end{equation}

Non-dimensionalizing by

\begin{equation}
	u_k^* = u_k/U_c \qquad
	t^* = t/t_c \qquad
	t_c = L_c/U_c \qquad
	\nabla^* = L_c \nabla \qquad
	\rho = \rho_c
\end{equation}
\begin{equation}
	p^* = p/\rho_c U_c^2 \qquad
	j_k^* = j_k/ \sigma_c U_c B_c \qquad
	B_k^* = B_k/B_c \qquad
	g_k^* = g_k/g_c \qquad
	T^* = \frac{T - T_c}{\Delta T_c}
\end{equation}

Note that $T_c$ may be $\Delta T_c$. With this yields

\begin{equation}
	\rho_c 
	\left( 
	\frac{U_c^2}{L_c} 
	\frac{\partial u_i^*}{\partial t} + 
	\frac{U_c^2}{L_c} 
	\frac{\partial (u_i^* u_j^*)}{\partial x_j^*}
	\right) 
	= 
	- \rho_c \frac{U_c^2}{L_c} 
	\frac{\partial p_i^*}{\partial x_i^*}
	+ \mu \frac{U_c}{L_c^2} 
	\frac{\partial^2 u_i^*}{\partial {x_j^*}^2}
	+ \rho_c g_c g_i^* 
	+ \rho_c g_c \beta \Delta T_c T^*g_i^*
	+ U_c B_c^2 \sigma_c 
	(j^* \times B^*)_i
\end{equation}

Dividing by $\frac{\rho_c U_c^2}{L_c}$ yields

\begin{equation}
	\frac{\partial u_i^*}{\partial t} + 
	\frac{\partial (u_i^* u_j^*)}{\partial x_j^*}
	= 
	- \frac{\partial p_i^*}{\partial x_i^*}
	+ \frac{\mu_c/\rho_c}{U_c L_c} 
	\frac{\partial^2 u_i^*}{\partial {x_j^*}^2}
	+ \frac{g_c L_c}{U_c^2}
	g_i^*
	+ \frac{g_c \beta_c \Delta T_c L_c^3}{\nu^2} \frac{\nu_c^2}{U_c^2 L_c^2} T^*g_i^*
	+ \frac{L_c B_c^2 \sigma_c}{\rho_c U_c}
	(j^* \times B^*)_i
\end{equation}

Note that

\begin{equation}
	Re = \frac{U_c L_c}{\nu_c} \qquad
	Ha = B_c L_c \sqrt{\frac{\sigma_c}{\mu_c}} \qquad
	Fr = \frac{U_c}{\sqrt{g_c L_c}} \qquad
	Gr = \frac{g_c \beta_c \Delta T_c L_c^3}{\nu^2}
\end{equation}

So we have

\begin{equation}
	\frac{\partial u_i^*}{\partial t} + 
	\frac{\partial (u_i^* u_j^*)}{\partial x_j^*}
	= 
	- \frac{\partial p_i^*}{\partial x_i^*}
	+ \frac{1}{Re}
	\frac{\partial^2 u_i^*}{\partial {x_j^*}^2}
	+ \frac{1}{Fr^2}
	g_i^*
	+ \frac{Gr}{Re^2}
	T^*g_i^*
	+ \frac{Ha^2}{Re}
	(j^* \times B^*)_i
\end{equation}

Removing the asterisk, we have

\begin{equation}
	\boxed{
	\frac{\partial u_i}{\partial t} + 
	\frac{\partial (u_i u_j)}{\partial x_j}
	= 
	- \frac{\partial p_i}{\partial x_i}
	+ \frac{1}{Re}
	\frac{\partial^2 u_i}{\partial x_j^2}
	+ \frac{1}{Fr^2}
	g_i
	+ \frac{Gr}{Re^2}
	T g_i
	+ \frac{Ha^2}{Re}
	(j \times B)_i
	}
\end{equation}


\subsection{Spatial discretization}
MOONS implements similar spatial discretization described in \cite{griebel1997numerical}. An extra ghost node is present in MOONS for easy implementation of Neumann BCs.

\subsection{Time discretization}
MOONS offers several time marching schemes including explicit Euler and a 3D ADI by . implements similar spatial discretization described in \cite{griebel1997numerical}
Below the equations are written for this method with minimal explanation, since it can be found in the reference. Also, a mixed index-vector notation has been used.
\begin{equation}
	\frac{u_i^{n+1}- u_i^{n}}{\Delta t} = - \partial_j (u_j^{n} u_i^{n}) 
	-\partial_i  p^{n+1} + 
	\frac{1}{Re} \partial_j \partial_j u_i^{n} + 
	\frac{Ha^2}{Re} \pmb{j^{n}} \times \pmb{B^{n}}
\end{equation}
Estimating for the velocity at the next time step, we have
\begin{equation}
	u_i^* = u_i^{n} + \Delta t \left[ - \partial_j (u_j^{n} u_i^{n}) + 
	\frac{1}{Re} \partial_j \partial_j u_i^{n} + 
	\frac{Ha^2}{Re} \pmb{j^{n}} \times \pmb{B^{n}} \right]
\end{equation}
And the pressure-correction step
\begin{equation}
	u_i^{n+1} = u_i^* -\partial_i p^{n+1}
\end{equation}
Where the implicit pressure is solved in
\begin{equation}
	\partial_j \partial_j p^{n+1} = \frac{1}{\Delta t} \partial_i u_i^n
\end{equation}


\bibliography{handpicked}
\bibliographystyle{plain}


\end{document}
