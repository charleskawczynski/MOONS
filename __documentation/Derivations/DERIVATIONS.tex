\newcommand{\bibDir}{../../../LATEX/} % Must come before config (config uses \bibDir)
\input{\bibDir configNarrow}
\usepackage{dirtree}
\usepackage{lmodern}
\usepackage{listings}
\usepackage{color}

\newcommand{\eqtab}{\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;}
\newcommand{\divBz}{$\nabla \bullet B = 0$}
\newcommand{\divB}{$\nabla \bullet B$}
\newcommand{\Rem}{$Re_m$}
\newcommand{\jcrossB}{$j \times B$}

%\newcommand{\figW}{6.5in}
%\newcommand{\figH}{5.5in}
\newcommand{\figW}{5.in}
\newcommand{\figH}{4.in}
%\newcommand{\figW}{6.825in}
%\newcommand{\figH}{5.775in}

\newcommand{\ffigW}{3.1in}
\newcommand{\ffigH}{3.1in}

\lstset{language=[90]Fortran,
  basicstyle=\ttfamily,
  keywordstyle=\color{red},
  commentstyle=\color{green},
  morecomment=[l]{!\ }% Comment only with space after !
}

\begin{document}

\doublespacing
\title{Magnetohydrodynamic Object-Oriented Numerical Simulation (MOONS) Derivations}
\author{C. Kawczynski \\
Department of Mechanical and Aerospace Engineering \\
University of California Los Angeles, USA\\
}
\maketitle

\section{Navier-Stokes Equation}
\subsection{Dimensionless NS with $j \times B$ Force}
\begin{equation}
\rho \left( \frac{\partial \pmb{u}}{\partial t} + \pmb{u} \bullet \nabla \pmb{u} \right) = 
-\nabla p + \mu \nabla^2 \pmb{u} + \pmb{f} + \pmb{j} \times \pmb{B}
\end{equation}
Where $\pmb{f}$ is some dimensional force per unit volume. Non-dimensionalizing by

\begin{equation}
\pmb{u}^* = \pmb{u}/U_c \eqtab
t^* = t/t_c \eqtab
t_c = a_c/U_c \eqtab
\nabla^* = a_c \nabla \eqtab
\rho = \rho_c
\end{equation}
\begin{equation}
p^* = p/\rho_c U_c^2 \eqtab
\pmb{j}^* = \pmb{j}/ \sigma_c U_c B_c \eqtab
\pmb{B}^* = \pmb{B}/B_c
\end{equation}
Yields
\begin{equation}
\rho_c \left( \frac{U_c^2}{a_c} \frac{\partial \pmb{u^*}}{\partial t} + \frac{U_c^2}{a_c} \pmb{u^*} \bullet \nabla^* \pmb{u^*} \right) = 
- \rho_c \frac{U_c^2}{a_c} \nabla^*  p^* + \mu \frac{U_c}{a_c^2} {\nabla^*}^2 \pmb{u^*} + \pmb{f} +
U_c B_c^2 \sigma_c \pmb{j^*} \times \pmb{B^*}
\end{equation}
Dividing by $\frac{\rho_c U_c^2}{a_c}$ yields
\begin{equation}
\frac{\partial \pmb{u^*}}{\partial t} + \pmb{u^*} \bullet \nabla^* \pmb{u^*} = 
- \nabla^*  p^* + 
\frac{\nu_c}{U_c a_c} {\nabla^*}^2 \pmb{u^*} + \frac{a_c}{\rho_c U_c^2} \pmb{f} + 
\frac{a_c B_c^2 \sigma_c}{\rho_c U_c} \pmb{j^*} \times \pmb{B^*}
\end{equation}
Re-ordering, and removing the asterisk, we have
\begin{equation}
\frac{\partial \pmb{u}}{\partial t} + \frac{U_c^2}{a_c} \pmb{u} \bullet \nabla \pmb{u} = 
- \nabla  p + 
\frac{\nu_c}{U_c a_c} {\nabla}^2 \pmb{u} + \frac{a_c}{\rho_c U_c^2} \pmb{f} + 
\frac{\mu_c}{\rho_c U_c a_c} 
\frac{a_c^2}{b_c^2} b_c^2 B_c^2 \frac{\sigma_c}{\rho_c \mu_c}
\pmb{j} \times \pmb{B}
\end{equation}
Finally, we have
\begin{equation}
\frac{\partial \pmb{u}}{\partial t} + \pmb{u} \bullet \nabla \pmb{u} = 
-\nabla  p + 
\frac{1}{Re} {\nabla}^2 \pmb{u} + \frac{a_c}{\rho_c U_c^2} \pmb{f} + 
\frac{Ha^2}{Re} \left( \frac{a_c}{b_c} \right)^2 \pmb{j} \times \pmb{B}
\end{equation}
Where
\begin{equation}
Re = \frac{U_c a_c}{\nu_c} \eqtab
Ha = B_c b_c \sqrt{\frac{\sigma_c}{\mu_c}} \end{equation}
Using the kronecker delta relation, we may write this as
\begin{equation}
\frac{\partial u_i }{\partial t} + u_j \partial_j u_i = 
-\partial_i  p + 
\frac{1}{Re} \partial_j \partial_j u_i + 
\frac{a_c}{\rho_c U_c^2} f_i +
\frac{Ha^2}{Re} \left( \frac{a_c}{b_c} \right)^2 \pmb{j} \times \pmb{B}
\end{equation}
We may write the $\pmb{j}\times \pmb{B}$ force as

\begin{equation}
\pmb{j}\times \pmb{B} = \epsilon_ijk j_j B_k = 
\epsilon_ijk \left( \epsilon_jmn \partial_m \frac{B_n}{\mu} B_k \right)
\end{equation}
\begin{equation}
= \epsilon_ijk \epsilon_jmn \left( \partial_m \frac{B_n}{\mu} B_k \right)
= \epsilon_jki \epsilon_jmn \left( \partial_m \frac{B_n}{\mu} B_k \right)
\end{equation}
\begin{equation}
= (\delta_{km} \delta_{in} - \delta_{kn} \delta_{im} ) \left( \partial_m \frac{B_n}{\mu} B_k \right)
\end{equation}
\begin{equation}
= \left( \partial_k \frac{B_i}{\mu} B_k \right) - 
\left( \partial_i \frac{B_k}{\mu} B_k \right)
\end{equation}

\begin{equation}
\pmb{j} \times \pmb{B} = B_k 
\left( \partial_k \frac{B_i}{\mu} - \partial_i \frac{B_k}{\mu} \right)
\end{equation}

\subsection{Time discretization}
MOONS implements the same time stepping procedure described in \cite{griebel1997numerical}. Below the equations are written for this method with minimal explanation, since it can be found in the reference. Also, a mixed index-vector notation has been used.
\begin{equation}
\frac{u_i^{n+1}- u_i^{n}}{\Delta t} = - \partial_j (u_j^{n} u_i^{n}) 
-\partial_i  p^{n+1} + 
\frac{1}{Re} \partial_j \partial_j u_i^{n} + 
\frac{Ha^2}{Re} \left( \frac{a_c}{b_c} \right)^2 \pmb{j^{n}} \times \pmb{B^{n}}
\end{equation}
Estimating for the velocity at the next time step, we have
\begin{equation}
u_i^* = u_i^{n} + \Delta t \left[ - \partial_j (u_j^{n} u_i^{n}) + 
\frac{1}{Re} \partial_j \partial_j u_i^{n} + 
\frac{Ha^2}{Re} \left( \frac{a_c}{b_c} \right)^2 \pmb{j^{n}} \times \pmb{B^{n}} \right]
\end{equation}
And the pressure-correction step
\begin{equation}
u_i^{n+1} = u_i^* -\partial_i p^{n+1}
\end{equation}
Where the implicit pressure is solved in
\begin{equation}
\partial_j \partial_j p^{n+1} = \frac{1}{\Delta t} \partial_i u_i^n
\end{equation}

\section{Induction Equation}
\subsection{Maxwells equations}
Maxwell's equations are
\begin{equation}
\pmb{j} = \nabla \times \frac{\pmb{B}}{\mu}
\eqtab
\frac{\partial \pmb{B}}{\partial t} = 
- \nabla \times \pmb{E}
\eqtab
\pmb{j} = \sigma (\pmb{E} + \pmb{u}\times \pmb{E})
\end{equation}
\begin{equation}
\nabla \bullet \pmb{j} = \pmb{0}
\eqtab
\nabla \bullet \pmb{B} = \pmb{0}
\eqtab
\pmb{H} = \frac{\pmb{B}}{\mu}
\end{equation}
Solving for the electric field of the current in Ohm's law yields
\begin{equation}
\pmb{E} = \frac{\pmb{j}}{\sigma} - \pmb{u} \times \pmb{B}
\end{equation}
Plugging this into Faraday's law yields
\begin{equation}
\frac{\partial \pmb{B}}{\partial t} = 
- \nabla \times \left[ \frac{\pmb{j}}{\sigma}
- \pmb{u} \times \pmb{B} \right]
\end{equation}
Distributing we have the induction equation
\subsection{Induction equation}
\begin{equation}
\frac{\partial \pmb{B}}{\partial t} = 
\nabla \times (\pmb{u} \times \pmb{B})
- \nabla \times 
\left[ \frac{1}{\sigma}
\nabla \times \frac{\pmb{B}}{\mu} \right]
\end{equation}
Non-dimensionalizing this by
\begin{equation*}
\nabla^* = b_c \nabla ,\eqtab
t^* = t/(a_c/U_c) ,\eqtab
B_i^* = B_i/B_c  ,\eqtab
\sigma^* = \sigma/\sigma_c
\end{equation*}
\begin{equation*}
\mu^* = \mu/\mu_c ,\eqtab
E_i^* = E_i/(U_c B_c) ,\eqtab
j_i^* = \frac{j}{B_i/(\mu_c b_c)}
\end{equation*}
Yields
\begin{equation}
\frac{\partial \pmb{B}}{\partial t} = 
\nabla \times (\pmb{u} \times \pmb{B})
- \nabla \times 
\left[ \frac{1}{\sigma}
\nabla \times \frac{\pmb{B}}{\mu} \right]
\end{equation}
Using the vector identity
\begin{equation}
\nabla \times (A\times B) = 
A(\nabla \bullet B) 
- B(\nabla \bullet A)
+(B \bullet \nabla)A - (A \bullet \nabla)B
\end{equation}
And noting that (index notation helps here)

\begin{equation}
\partial_j (u_i B_j) = 
u_i \underbrace{\partial_j B_j}_\text{= 0} + B_j \partial_j u_i
= B_j \partial_j u_i
\end{equation}

\begin{equation}
\partial_j (u_j B_i) = 
u_j \partial_j B_i + B_i \underbrace{\partial_j u_j}_\text{=0}
= u_j \partial_j B_i
\end{equation}

we can write our advective term as

\begin{equation}
\nabla \times (u \times B) 
= u(\nabla \bullet B) 
- B(\nabla \bullet u)
+ (B \bullet \nabla)u
- (u \bullet \nabla)B
=
\partial_j (u_i B_j) - \partial_j (u_j B_i)
=
-\partial_j (u_j B_i - u_i B_j)
\end{equation}

Moving everything to the RHS, we may write our equation in vector form as

\begin{equation}
\frac{\partial \pmb{B}}{\partial t} = 
\nabla \times (\pmb{u} \times \pmb{B})
- \nabla \times 
\left[ \frac{1}{\sigma}
\nabla \times \frac{\pmb{B}}{\mu} \right]
\end{equation}

Using the kronecker delta identity, the diffusion term may be written as

\begin{equation}
\nabla
\end{equation}
\begin{equation}
=
\end{equation}

Finally, we may write our full induction equation as
\begin{equation}
\frac{\partial B_i}{\partial t} = 
\end{equation}

This is the full induction equation written in a conservative finite difference form. This is the form that is implemented in MOONS.


%\subsection{Time discretization}
%
%\section{Poisson Equation}
%\subsection{3D Non-uniform Grid SOR}
%
%\section{Derivatives}
%\subsection{Collocated for non-uniform grid}
%\subsection{Staggered for non-uniform grid}
%
%\section{Boundary Conditions}
%\subsection{Dirichlet - Direct - (wall coincident)}
%\subsection{Dirichlet - Interpolated - (wall incoincident)}
%\subsection{Neumann - Direct - (wall coincident)}
%\subsection{Neumann - Interpolated - (wall incoincident)}
%\subsection{Periodic - Direct - (wall coincident)}
%\subsection{Periodic - Interpolated - (wall incoincident)}
%
%\section{Interpolations}
%\subsection{Cell center, edge}
%
%\section{Other derivations}
%
%\subsection{Equation for matching stretching factors}
%
%\subsection{Newton's Method (for matching stretching factors)}



\bibliographystyle{unsrt}
\bibliography{\myBib}

\end{document}


