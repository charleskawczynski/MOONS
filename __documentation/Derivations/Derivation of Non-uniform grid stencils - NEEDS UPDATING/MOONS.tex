\documentclass[11pt]{article}
\usepackage{graphicx}    % needed for including graphics e.g. EPS, PS
\usepackage{epstopdf}
\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{xspace}
\usepackage{mathtools}
\usepackage{tikz}
\usepackage{epsfig}
\usepackage{float}
\usepackage{natbib}
\usepackage{subfigure}
\usepackage{setspace}
\usepackage{tabularx,ragged2e,booktabs,caption}

\newcommand{\height}{0.4}
\newcommand{\radius}{0.1}
\newcommand{\offSet}{12}
\newcommand{\Deltah}{1.6666}

\setlength{\oddsidemargin}{0.1in}
\setlength{\textwidth}{7.25in}

\setlength{\topmargin}{-1in}     %\topmargin: gap above header
\setlength{\headheight}{0in}     %\headheight: height of header
\setlength{\topskip}{0in}        %\topskip: between header and text
\setlength{\headsep}{0in}        
\setlength{\textheight}{692pt}   %\textheight: height of main text
\setlength{\textwidth}{7.5in}    % \textwidth: width of text
\setlength{\oddsidemargin}{-0.5in}  % \oddsidemargin: odd page left margin
\setlength{\evensidemargin}{0in} %\evensidemargin : even page left margin
\setlength{\parindent}{0.25in}   %\parindent: indentation of paragraphs
\setlength{\parskip}{0pt}        %\parskip: gap between paragraphs
\setlength{\voffset}{0.5in}


% Useful commands:

% \hfill		aligns-right everything right of \hfill

\begin{document}
\doublespacing
\title{Magnetohydrodynamic Object-Oriented Numerical Simulation (MOONS)}
\author{C. Kawczynski \\
Department of Mechanical and Aerospace Engineering \\
University of California Los Angeles, USA\\
}
\maketitle

\section{Note - Document Obsolete}

This document is old. I should have written a python script to compute these stencils symbolically. Doing algebra by hand is dangerous, and I should have used a linear algebra solver.

\section{Derivation of stencils for derivatives with non-uniform grids}

This document contains the derivatives of hte 1st and 2nd derivative of a function using function values at location $x_i, \alpha_k$ and $\beta_j$ with respective indexes. These derivatives are only valid for collocated data.

\section{Diagram of stencils}
\begin{figure}[h!]
  \begin{center}
    \begin{tikzpicture}
      \draw [black] (0,0) to (4.5,0);
      \draw [black,dashed] (4.5,0) to (5.5,0);
      \draw [black] (5.5,0) to (10,0);

      % Nodes
      \draw [black] (0*\Deltah,-\height) to (0+0*\Deltah,\height);
      \draw [black] (1*\Deltah,-\height) to (0+1*\Deltah,\height);
      \draw [black] (2*\Deltah,-\height) to (0+2*\Deltah,\height);
      % \draw [black] (3*\Deltah,-\height) to (0+3*\Deltah,\height);
      \draw [black] (4*\Deltah,-\height) to (0+4*\Deltah,\height);
      \draw [black] (5*\Deltah,-\height) to (0+5*\Deltah,\height);
      \draw [black] (6*\Deltah,-\height) to (0+6*\Deltah,\height);

      % CCs
      \draw [black] (0*\Deltah+\Deltah/2,0) circle [radius=\radius];
      \draw [black] (1*\Deltah+\Deltah/2,0) circle [radius=\radius];
      % \draw [black] (2*\Deltah+\Deltah/2,0) circle [radius=\radius];
      % \draw [black] (3*\Deltah+\Deltah/2,0) circle [radius=\radius];
      \draw [black] (4*\Deltah+\Deltah/2,0) circle [radius=\radius];
      \draw [black] (5*\Deltah+\Deltah/2,0) circle [radius=\radius];

      \draw (0*\Deltah,0) node [black,below=\offSet] {$f_{1}$};
      \draw (1*\Deltah,0) node [black,below=\offSet] {$f_{2}$};
      \draw (2*\Deltah,0) node [black,below=\offSet] {$f_{3}$};

      \draw (4*\Deltah,0) node [black,below=\offSet] {$f_{sn-2}$};
      \draw (5*\Deltah,0) node [black,below=\offSet] {$f_{sn-1}$};
      \draw (6*\Deltah,0) node [black,below=\offSet] {$f_{sn}$};

    \end{tikzpicture}
    \caption{Index convention for node / face centered data}
  \end{center}
\end{figure}


\section{Problem setup}
The results from this document were obtained by solving the following system of equations, all of which are Taylor expansions about location $x_i$.

\begin{equation}
	f_{i+k} = f_{i} + \alpha_k f_i' + \frac{1}{2}\alpha_k^2 f_i'' + O(\alpha_k^3)
\end{equation}
\begin{equation}
	f_{i+j} = f_{i} + \beta_j f_i' + \frac{1}{2}\beta_j^2 f_i'' + O(\beta_j^3)
\end{equation}
\begin{equation}
	f_{i+k} = f_{i} + \alpha_k f_i' + \frac{1}{2}\alpha_k^2 f_i'' + \frac{1}{3!}\alpha_k^3 f_i''' + O(\alpha_k^4)
\end{equation}
\begin{equation}
	f_{i+j} = f_{i} + \beta_j f_i' + \frac{1}{2}\beta_j^2 f_i'' + \frac{1}{3!}\beta_j^3 f_i''' + O(\beta_j^4)
\end{equation}

\section{Algebra}
Some linear algebra system should be used to solve this system of equations symbolically (e.g. python or matlab). In addition, this would be helpful to not only have the \textit{order} of accuracy (which is shown in this document), but to include the quantitative coefficient of the truncation error.

\section{Results}
\subsection{1st derivative}
Solving this system (only the first two) for $f_i'$, we have
\begin{equation}
	\boxed{
	f_i' = 
	\frac{1}{\beta_j - \alpha_k}
	\left[
	f_i \left( \frac{\alpha_k}{\beta_j} - \frac{\beta_j}{\alpha_k}\right)
	+ \frac{\beta_j}{\alpha_k} f_{i+k}
	- \frac{\alpha_k}{\beta_j} f_{i+j}
	\right]
	+ O(\alpha_k \beta_j)
	}
\end{equation}

\subsection{2nd derivative}

\begin{equation}
	\boxed{
	f_i'' = 
	\frac{2f_i}{\alpha_k \beta_j}
	+
	\frac{2f_{i+k}}{\alpha_k^2-\alpha_k \beta_j}
	+
	\frac{2f_{i+j}}{\beta_j^2 - \beta_j \alpha_k}
	+ O(-\beta_j \alpha_k - (\beta_j+\alpha_k))
	}
\end{equation}

\section{Verification by simplification to uniform grid stencils}
In the momentum equation, the diffusive terms may be written as

\begin{equation}
  f'' = \frac{1}{\Delta x_{i+1/2}}
  \left(
  \frac{f_{i+1} - f_i}{\Delta x_{i+1}}
  -
  \frac{f_{i} - f_{i-1}}{\Delta x_{i}}
  \right)
\end{equation}

Or

\begin{equation}
  f'' = 
  \frac{2}{\Delta x_{i+1} + \Delta x_{i}}
  \left(
  \frac{f_{i+1} - f_i}{\Delta x_{i+1}}
  -
  \frac{f_{i} - f_{i-1}}{\Delta x_{i}}
  \right)
\end{equation}

We may factor the terms:

\begin{equation}
  f'' = 
  f_i
  \left(
  \frac{-2}{\Delta x_{i+1} + \Delta x_i}
  \left(
  \frac{1}{\Delta x_{i+1}}+\frac{1}{\Delta x_{i}}
  \right)
  \right)
  +
  f_{i-1}
  \frac{2}{\Delta x_i (\Delta x_{i+1} + \Delta x_i)}
  +
  f_{i+1}
  \frac{2}{\Delta x_{i+1} (\Delta x_{i+1} + \Delta x_i)}
\end{equation}

The $ith$ term may be written as

\begin{equation}
  \frac{-2}{\Delta x_{i+1} + \Delta x_i}
  \left(
  \frac{1}{\Delta x_{i+1}}+\frac{1}{\Delta x_{i}}
  \right)
  =
  \frac{-2}{\Delta x_i \Delta x_{i+1} (\Delta x_i + \Delta x_{i+1})}
  (\Delta x_i + \Delta x_{i+1})
  =
  \frac{-2}{\Delta x_i \Delta x_{i+1}}
\end{equation}

Therefore, we may write the derivative as

\begin{equation}
  f'' 
  = 
  2 f_i
  \frac{1}{-\Delta x_i \Delta x_{i+1}}
  +
  2 f_{i-1}
  \frac{1}{\Delta x_i (\Delta x_{i+1} + \Delta x_i)}
  + 
  2 f_{i+1}
  \frac{1}{\Delta x_{i+1} (\Delta x_{i+1} + \Delta x_i)}
\end{equation}

Now, using the non-uniform grid stencil results, let

\begin{equation}
  \alpha_k = -\Delta x_i \qquad k = -1
\end{equation}
\begin{equation}
  \beta_j = \Delta x_{i+1} \qquad j = 1
\end{equation}

We may write this as

\begin{equation}
  f''
  =
  2 f_i \frac{1}{\alpha_k \beta_j}
  +
  2 f_{i-1}
  \frac{1}{-\alpha_k (\beta_j-\alpha_k)}
  + 2 f_{i+1}
  \frac{1}{\beta_j(\beta_j-\alpha_k)}
\end{equation}

Or

\begin{equation}
  f''
  =
  \frac{2 f_i}{\alpha_k \beta_j}
  +
  \frac{2 f_{i+k}}{\alpha_k^2 - \alpha_k \beta_j}
  +
  \frac{2 f_{i+j}}{\beta_j^2 - \beta_j \alpha_k}
\end{equation}

This is the same form of the equation derived.

\end{document}